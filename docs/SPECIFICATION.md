# E2E Testing Application 仕様書

このドキュメントでは、E2E Testing Applicationの詳細な仕様について説明します。

## 目次

1. [アプリケーション概要](#アプリケーション概要)
2. [システムアーキテクチャ](#システムアーキテクチャ)
3. [機能仕様](#機能仕様)
   - [プロジェクト管理](#プロジェクト管理)
   - [機能一覧管理](#機能一覧管理)
   - [仕様書からの機能抽出](#仕様書からの機能抽出)
   - [ブラウザ操作](#ブラウザ操作)
4. [データモデル](#データモデル)
5. [API仕様](#api仕様)
6. [UI/UX仕様](#uiux仕様)
7. [技術的要件](#技術的要件)

## アプリケーション概要

E2E Testing Applicationは、Webアプリケーションのテスト自動化を支援するためのElectronベースのデスクトップアプリケーションです。主な目的は以下の通りです：

- プロジェクト単位でテスト対象のWebサイトを管理
- 仕様書から機能一覧を自動抽出し、テスト計画の基礎として活用
- ブラウザ操作を通じてユーザーインタラクションを記録・分析
- テスト結果の可視化と管理

## システムアーキテクチャ

アプリケーションは以下の主要コンポーネントで構成されています：

1. **Electronアプリケーション（フロントエンド）**
   - メインプロセス：アプリケーションのライフサイクル管理、IPC通信
   - レンダラープロセス：React UIコンポーネント
   - プリロードスクリプト：安全なIPC通信の実現

2. **NestJS APIサーバー（バックエンド）**
   - RESTful APIエンドポイント
   - ビジネスロジック
   - データベースアクセス層

3. **PostgreSQLデータベース**
   - プロジェクト情報
   - 機能一覧
   - テスト結果（将来実装）

4. **OpenAI GPT-4o統合**
   - 仕様書からの機能抽出
   - 自然言語処理

## 機能仕様

### プロジェクト管理

#### プロジェクト作成

- **入力項目**：
  - プロジェクト名（必須）：100文字以内
  - プロジェクトURL（必須）：有効なURL形式
  - 説明（任意）：テキスト

- **バリデーション**：
  - プロジェクト名は空にできない
  - URLは有効な形式である必要がある

- **保存処理**：
  - プロジェクト情報はデータベースに保存
  - 作成日時と更新日時は自動的に記録

#### プロジェクト一覧

- プロジェクト名、URL、作成日時、更新日時を表示
- プロジェクトカードをクリックして選択可能
- 新規プロジェクト作成ボタンを表示

### 機能一覧管理

#### 機能一覧表示

- プロジェクトに関連付けられた機能一覧を表示
- 各機能には以下の情報を表示：
  - 機能名
  - 機能の詳細説明
  - 作成日時

- 表示形式：
  - カード形式でグリッドレイアウト
  - 機能がない場合は適切なメッセージを表示

#### 機能の保存

- 抽出された機能をデータベースに保存
- プロジェクトとの関連付け
- 重複チェック（将来実装）

### 仕様書からの機能抽出

#### 仕様書入力

- テキスト入力エリアで直接入力
- ファイルアップロード（将来実装：.txt, .md, .docx形式）
- 入力検証：
  - 空の入力はエラーメッセージを表示

#### 機能抽出処理

- **使用技術**：
  - OpenAI GPT-4o
  - LangChain フレームワーク
  - Zod スキーマバリデーション

- **抽出プロセス**：
  1. 仕様書テキストを前処理
  2. LangChainとOpenAI GPT-4oを使用して機能を抽出
  3. 抽出された機能を構造化データに変換
  4. 結果を画面に表示

- **抽出される情報**：
  - 機能名：簡潔で明確な名前
  - 機能説明：詳細な説明文

### ブラウザ操作

#### Webサイト表示

- プロジェクトURLを使用してWebサイトを表示
- URLバーでアドレスを手動変更可能
- 戻る、進む、更新ボタンを実装

#### イベント記録

- 以下のユーザーインタラクションを自動記録：
  - クリックイベント（要素のセレクタ、テキスト）
  - フォーム入力（フィールド名、入力値）
  - ホバーイベント
  - ページ遷移

- ホバー要素の視覚的強調：
  - 「ラベル登録」ボタンを有効にすると、マウスカーソルがホバーしているDOM要素を赤い点線のボーダーで囲んで強調表示
  - ボタンは右上に配置され、有効時は赤色に変化
  - ホバーが終了すると自動的に強調表示を解除

- イベントログ表示：
  - リアルタイムでイベントを表示
  - タイムスタンプ付き
  - イベントタイプによる色分け

## データモデル

### Project（プロジェクト）

| フィールド | 型 | 説明 |
|------------|------|-------------|
| id | UUID | プライマリキー |
| name | String | プロジェクト名（最大100文字） |
| url | String | プロジェクトURL |
| description | String | プロジェクト説明（オプション） |
| createdAt | DateTime | 作成日時 |
| updatedAt | DateTime | 更新日時 |

### Feature（機能）

| フィールド | 型 | 説明 |
|------------|------|-------------|
| id | UUID | プライマリキー |
| name | String | 機能名（最大100文字） |
| description | String | 機能の詳細説明 |
| projectId | UUID | 関連するプロジェクトのID（外部キー） |
| createdAt | DateTime | 作成日時 |
| updatedAt | DateTime | 更新日時 |

## API仕様

### プロジェクト関連

#### GET /api/projects

全プロジェクトを取得します。

**レスポンス例**：
```json
[
  {
    "id": "123e4567-e89b-12d3-a456-426614174000",
    "name": "Example Project",
    "url": "https://example.com",
    "description": "This is an example project",
    "createdAt": "2023-01-01T00:00:00.000Z",
    "updatedAt": "2023-01-01T00:00:00.000Z"
  }
]
```

#### GET /api/projects/:id

指定したIDのプロジェクトを取得します。

**パラメータ**：
- `id`: プロジェクトID（UUID）

**レスポンス例**：
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174000",
  "name": "Example Project",
  "url": "https://example.com",
  "description": "This is an example project",
  "createdAt": "2023-01-01T00:00:00.000Z",
  "updatedAt": "2023-01-01T00:00:00.000Z"
}
```

#### POST /api/projects

新規プロジェクトを作成します。

**リクエスト本文**：
```json
{
  "name": "New Project",
  "url": "https://newproject.com",
  "description": "A new project description"
}
```

**レスポンス例**：
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174000",
  "name": "New Project",
  "url": "https://newproject.com",
  "description": "A new project description",
  "createdAt": "2023-01-01T00:00:00.000Z",
  "updatedAt": "2023-01-01T00:00:00.000Z"
}
```

#### PUT /api/projects/:id

指定したIDのプロジェクトを更新します。

**パラメータ**：
- `id`: プロジェクトID（UUID）

**リクエスト本文**：
```json
{
  "name": "Updated Project",
  "url": "https://updatedproject.com",
  "description": "An updated project description"
}
```

**レスポンス例**：
```json
{
  "id": "123e4567-e89b-12d3-a456-426614174000",
  "name": "Updated Project",
  "url": "https://updatedproject.com",
  "description": "An updated project description",
  "createdAt": "2023-01-01T00:00:00.000Z",
  "updatedAt": "2023-01-01T00:00:00.000Z"
}
```

#### DELETE /api/projects/:id

指定したIDのプロジェクトを削除します。

**パラメータ**：
- `id`: プロジェクトID（UUID）

**レスポンス**：
- 204 No Content（成功時）

### 機能関連

#### GET /api/projects/:id/features

指定したプロジェクトの機能一覧を取得します。

**パラメータ**：
- `id`: プロジェクトID（UUID）

**レスポンス例**：
```json
[
  {
    "id": "789e4567-e89b-12d3-a456-426614174000",
    "name": "ユーザーログイン",
    "description": "ユーザーがメールアドレスとパスワードを使用してシステムにログインする機能",
    "createdAt": "2023-01-01T00:00:00.000Z",
    "updatedAt": "2023-01-01T00:00:00.000Z",
    "projectId": "123e4567-e89b-12d3-a456-426614174000"
  }
]
```

#### GET /api/features

すべての機能を取得します。

**レスポンス例**：
```json
[
  {
    "id": "789e4567-e89b-12d3-a456-426614174000",
    "name": "ユーザーログイン",
    "description": "ユーザーがメールアドレスとパスワードを使用してシステムにログインする機能",
    "createdAt": "2023-01-01T00:00:00.000Z",
    "updatedAt": "2023-01-01T00:00:00.000Z",
    "projectId": "123e4567-e89b-12d3-a456-426614174000"
  }
]
```

#### POST /api/features/extract

仕様書から機能を抽出します。

**リクエスト本文**：
```json
{
  "text": "ユーザーはメールアドレスとパスワードでログインできる。パスワードを忘れた場合はリセット機能を使用できる。"
}
```

**レスポンス例**：
```json
{
  "features": [
    {
      "name": "ユーザーログイン",
      "description": "ユーザーがメールアドレスとパスワードを使用してシステムにログインする機能"
    },
    {
      "name": "パスワードリセット",
      "description": "ユーザーがパスワードを忘れた場合に、パスワードをリセットする機能"
    }
  ]
}
```

#### POST /api/features/save

抽出された機能を保存します。

**リクエスト本文**：
```json
{
  "features": [
    {
      "name": "ユーザーログイン",
      "description": "ユーザーがメールアドレスとパスワードを使用してシステムにログインする機能"
    }
  ],
  "projectId": "123e4567-e89b-12d3-a456-426614174000"
}
```

**レスポンス例**：
```json
[
  {
    "id": "789e4567-e89b-12d3-a456-426614174000",
    "name": "ユーザーログイン",
    "description": "ユーザーがメールアドレスとパスワードを使用してシステムにログインする機能",
    "createdAt": "2023-01-01T00:00:00.000Z",
    "updatedAt": "2023-01-01T00:00:00.000Z",
    "projectId": "123e4567-e89b-12d3-a456-426614174000"
  }
]
```

## UI/UX仕様

### 全体的なデザイン

- モダンでクリーンなインターフェース
- レスポンシブデザイン
- 一貫したカラースキーム：
  - プライマリカラー: #4285f4（青）
  - セカンダリカラー: #34a853（緑）
  - アクセントカラー: #ea4335（赤）
  - 背景色: #f5f5f5（ライトグレー）
  - テキスト: #333333（ダークグレー）

### 画面遷移

1. **初回起動時**：プロジェクト作成画面
2. **プロジェクト作成後**：メニュー画面
3. **メニュー画面から**：
   - 機能一覧画面
   - 仕様書アップロード画面
   - ブラウザ操作画面
   - プロジェクト一覧画面

### 各画面の詳細

#### メニュー画面

- 現在のプロジェクト情報を上部に表示
- 大きなカードスタイルのボタン
- 各機能へのアクセス：
  - 機能一覧
  - 仕様書のアップロード
  - ブラウザ操作
  - プロジェクト一覧

#### 仕様書アップロード画面

- テキストエリア（高さ300px以上）
- ファイルアップロードボタン（将来実装）
- 送信ボタン
- 結果表示エリア：
  - 抽出された機能をカード形式で表示
  - 保存ボタン
  - 機能一覧画面へのリンク

#### 機能一覧画面

- プロジェクト名を上部に表示
- 機能をカード形式でグリッドレイアウト表示
- 各カードには：
  - 機能名（太字）
  - 機能説明
  - 作成日時
- 仕様書アップロード画面へのリンク
- メニューに戻るボタン

## 技術的要件

### フロントエンド

- **Electron**: v25.0.0以上
- **React**: v18.0.0以上
- **TypeScript**: v5.0.0以上
- **CSS**: モジュラーCSS

### バックエンド

- **NestJS**: v10.0.0以上
- **Node.js**: v18.0.0以上
- **Prisma ORM**: v5.0.0以上

### データベース

- **PostgreSQL**: v14.0以上

### AI/ML

- **OpenAI API**: GPT-4o
- **LangChain**: v0.1.0以上
- **Zod**: v3.0.0以上

### 開発環境

- **Turborepo**: モノレポ管理
- **ESLint**: コード品質管理
- **Prettier**: コードフォーマット
- **Jest**: ユニットテスト
- **Docker**: 開発環境の一貫性確保

### セキュリティ要件

- コンテキスト分離によるレンダラープロセスの保護
- Node.js統合の無効化
- 安全なIPC通信
- 環境変数による機密情報の管理
